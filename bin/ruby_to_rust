#!/usr/bin/env ruby

require "thor"
require "#{__dir__}/ruby_to_rust_one"

require "#{__dir__}/../methods/array_list"
require "#{__dir__}/../methods/string_list"
require "#{__dir__}/../methods/file_list"

ALL_CONTENTS = [
  ARRAY_LIST,
  STRING_LIST,
  FILE_LIST,
]

class RubyToRust < Thor
  default_command :runner

  desc "runner", "一括変換"
  option :range,           type: :string,  aliases: "-r", default: nil,       desc: "範囲"
  option :target,          type: :string,  aliases: "-t", default: "nightly", desc: "rustc の種類"
  option :method,          type: :string,  aliases: "-m", default: nil,       desc: "対象メソッド"
  option :class,           type: :string,  aliases: "-c", default: nil,       desc: "対象クラス"
  option :playground_link, type: :boolean, aliases: "-p", default: false,     desc: "Playgroundへのリンク"
  def runner
    new_options = options.transform_keys(&:to_sym)
    list = ALL_CONTENTS
    if v = new_options[:class]
      list = list.find_all { |e| e[:name].match?(v) }
    end
    list.each do |e|
      RubyToRustOne.new(e.merge(new_options)).run
    end
  end
end

RubyToRust.start
